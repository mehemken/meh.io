<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/static/images/Favicon.ico">
    <link rel="icon" href="/static/images/Favicon.ico">

    <title>mehemken.io</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/bootstrap/bootstrap-3.3.7-dist/css/bootstrap.min.css " rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/sticky-footer-navbar.css" rel="stylesheet">
<style>
.bg-4 {
    background-color: #f5f5f5;
}
</style>
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">mehemken.io</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
              <li><a href="/blog/">Blog</a></li>
              <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">More stuff<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">Professional</li>
                <li><a href="https://www.linkedin.com/in/mehemken">LinkedIn</a></li>
                <li><a href="https://github.com/mehemken">GitHub</a></li>
                <li><a href="http://stackoverflow.com/cv/mehemken">StackOverflow CV</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Social</li>
                <li><a href="https://twitter.com/mehemken">Twitter</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <!-- Begin page content -->
    <div class="container">
        <div class="row">
	    <div class="col-xs-8 col-sm-8 col-lg-8">
            <h1>Getting started w/ AWS CLI and Boto3</h1>
            <p class="lead">13 May 2017</p>
            <hr>
            <p>This post is in progress...</p>
<h2>Installing the AWS CLI</h2>
<p>First and foremost, I recommend the <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" title="Installing the AWS CLI">AWS CLI Installation Instructions</a> provided by Amazon. They are pretty straightforward (if you're on linux). I can only vouch for the Linux version of this as I have not tried it on Windows.</p>
<p>If you are working on a Windows system you won't be able to follow along in this tutorial. I recommend you spin up a VM or dual boot your computer. Or better yet, spin up an EC2 instance and connect to it. I recommend using the Amazon Linux AMI as it comes with the AWS CLI preinstalled [citation needed]. If you have Ubuntu and Python 2.6.5+ or Python 3.3+ installation is as easy as</p>
<pre><code>$ pip install --upgrade --user awscli
</code></pre>
<p>For more info on the flags there see the <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" title="Installing the AWS CLI">AWS Docs</a> on it. After you've installed it you may need to add the tool to your PATH. The default directory where the CLI is installed is <code>~/.local/bin</code>, but double check first.</p>
<pre><code>$ ls ~/.local/bin
aws                 aws_zsh_completer.sh  ...
aws_bash_completer  jp.py                 ...
...
$ export PATH=~/.local/bin:$PATH
</code></pre>
<p>If you don't see the <code>aws</code> binary in that directory, you'll have to do some troubleshooting. See the <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html" title="Installing the AWS CLI">docs</a>. Another thing you might find useful is <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-command-completion.html" title="AWS CLI autocompletion guide">autocompletion</a>. This should be as easy as adding a line to your terminal emulator's rc file.</p>
<p>If you don't know what terminal you have, you're most likely using bash. In your favorite editor open <code>~/.bashrc</code>. For those new to a Linux environment, it is a hidden file so you may not be able to see it by default in your file finder. There should be an option somewhere to reveal it. Add this to the end of the file</p>
<pre><code>complete -C '&lt;installation directory&gt;/aws_completer' aws
</code></pre>
<p>Where <code>&lt;installation directory&gt;</code> is <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-command-completion.html#cli-command-completion-completer" title="Locate the AWS Completer">the directory where pip installed the AWS CLI</a>. I happen to be using the zsh completer and I didn't run into any issues with the instructions on the AWS <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-command-completion.html" title="AWS CLI autocompletion guide">autocompletion Docs</a>.</p>
<hr />
<h2>First steps with the CLI</h2>
<p>What you'll get out of this tutorial is a hello-world type automation script. We'll be creating an EC2 instance and an S3 bucket. Then we'll add some IAM security controls on them.</p>
<p>Funny enough, you can't just do something like</p>
<pre><code>$ aws EC2 launch instance
</code></pre>
<p>That does not exist. We will have to write a <a href="https://aws.amazon.com/documentation/cloudformation/" title="CloudFormation Docs">CloudFormation</a> template. These are json or yaml files that describe the resources you want to launch in AWS. Get your favorite editor and write this:</p>
<pre><code>// file: hello-bucket.json
{
    "Resources" : {
        "HelloBucket" : {
            "Type" : "AWS::S3::Bucket"
        }
    }
}
</code></pre>
<p>Here, you are defining a resource and its name is HelloBucket. It is an S3 bucket. We can now use the CLI to launch this.</p>
<p>You will want to see what's going on here. Before you do anything, open up your AWS console. I'm assuming you know how to navigate it. In the Services dropdown under Storage, pick S3. Notice how nothing there is named HelloBucket.</p>
<p>Now enter the following command. Make sure you're in the directory that contains the file.</p>
<pre><code># Line breaks included for clarity.
# Don't include them in your terminal.

$ aws cloudformation deploy
    --template-file hello-bucket.json
    --stack-name helloBucketStack
</code></pre>
<p>It will take a minute to set things up, but once it's done, click the circular refresh arrows on the AWS S3 page. You should see something like <code>hellobucketstack-hellobucket-1imwav37498hg</code>.</p>
<p>The beauty of this is that AWS treats this bucket as part of a template. If you tear down the template, you tear down everyting. (You can choose to keep buckets when taking down a CloudFormation template, but that's outside the scope of this article.)</p>
<pre><code>$ aws cloudformation describe-stacks
</code></pre>
<p>This will show you some descriptive things about your stack. If your stack failed to complete, you'll see some helpful hints in the output. For now, let's get rid of it and create something new.</p>
<pre><code>$ aws cloudformation delete-stack
    --stack-name helloBucketStack
</code></pre>
<p>Let's go back to the template and add a resource. You will notice that I've added a "<a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html#aws-resource-ec2-instance-syntax" title="EC2 Syntax">Properties</a>" list. These are the two required properties for an EC2 instance to launch. If you do not include them, your stack will begin to launch, but it will fail and eventually it will be rolled back. The tag property is not required but it's always nice to name your stuff.</p>
<pre><code>// file: hello-bucket.json
{
    "Resources" : {
        "HelloBucket" : {
            "Type" : "AWS::S3::Bucket"
        },
        "HelloT2micro" : {
            "Type" : "AWS::EC2::Instance",
            "Properties" : {
                "InstanceType" : "t2.micro",
                "ImageId" : "ami-efd0428f"
                "Tags" : [ {"Key":"Name", "Value":"El tagerino"} ]
            }
        }
    }
}
</code></pre>
<p>The ImageId I'm using here is the Ubuntu 16.04 image for us-west-2 (citation needed).</p>
<hr />
<h3>Basic security with IAM Roles</h3>
<p>You might say, well that's not secure at all. Let's add some roles to that. The first thing we'll need to do is create a new role.</p>
<p>There seems to be two ways to go about this. One way is to create the role within your CloudFormation template and the other is to use the <code>aws iam</code> command. The latter option seems a bit manual. Why not include it in the CloudFormation template so we can make it repeatable?</p>
<p>To create a key use this command:</p>
<pre><code>aws ec2 create-key-pair \
    --key-name MyKeyPair \
    --query 'KeyMaterial' \
    --output text &gt; MyKeyPair.pem
</code></pre>
<h3>Notes and next steps</h3>
<p>To do<br />
- Secure the EC2 with IAM and some pem keys<br />
- Create a pem key
- Include the pem key in the CloudFormation template for the EC2 instance </p>
<hr />
<h2>Installing Boto3</h2>
<p>These are boto3 installation instructions...</p>
<hr />
<h2>Hello-world for Boto3</h2>
<p>Here's how to run the same CloudFormation template from a Python script.</p>
            <!--
            -->
	    </div>
	</div>
    </div>

    <footer class="footer">
      <div class="container">
	  <div class="row">
	    <div class="col-xs-4">
		<p class="text-muted"><span class="glyphicon glyphicon-copyright-mark"></span> M. Hemken 2017</p>
	    </div>
	    <div class="col-xs-4">
                <p class="text-muted"><a href=""><span class="glyphicon glyphicon-download"></span> Resume</a></p>
	    </div>
	    <div class="col-xs-4"></div>
	  </div>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="/static/jquery/jquery.min.js"></script>
    <script src="/static/bootstrap/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
  </body>
</html>